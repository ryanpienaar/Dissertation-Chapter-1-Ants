---
title: "eCog_Ant_mound"
author: "R Pienaar"
date: "`r Sys.Date()`"
output: word_document
---

Libraries

```{r}

library(ggplot2)
library(tidyverse)


```


Insert data:
Input is a combined csv from arc that shows individual disks per treatment and block

```{r}

disks <- read.csv("Results_all_years.csv")

head(disks)

disks <- disks %>% select(Class_name, Block, Plot, Fire, Rodents, Shape_Area, Year)

```

Create total area per treatment block

```{r}

area <- disks %>% 
  group_by(Block, Plot, Year) %>%
  summarise(Total_Shape_Area = sum(Shape_Area))

complete_combinations <- disks %>%
  distinct(Block, Plot, Year) %>%
  expand(Block, Plot, Year)

# Perform a full join with the original dataframe
area <- complete_combinations %>%
  left_join(area, by = c("Block", "Plot", "Year")) %>%
  mutate(Total_Shape_Area = ifelse(is.na(Total_Shape_Area), 0, Total_Shape_Area))

area <- area %>%
  mutate(Burned = substr(Plot, 1, 1),
         Rodents = substr(Plot, 2, 2))



```

Now I want to update my areas for 2016 with more accurate data so I'm going to swap out the 2016 years with Tara's from 2016

```{r}

j2016_area <- read.csv("C:/Users/ryanp/Documents/Dissertation/Chapter1_Ants/Ant_analysis_manua;/Josh_drone_area_2016.csv")
j2016_area <- j2016_area |> select(BLOCK, PLOT, AREA_m_2_)


j2016_area <- j2016_area |> 
  group_by(BLOCK, PLOT) %>%
  summarise(Total_Shape_Area = sum(AREA_m_2_))

j2016_area <- j2016_area %>%
  mutate_all(~replace(., . == "BS","BR"))

j2016_area <- j2016_area %>%
  mutate_all(~replace(., . == "US","UR"))


j2016_area$Year <- 2016
j2016_area<- j2016_area %>% mutate(Burned = substr(PLOT, 1, 1),
         Rodents = substr(PLOT, 2, 2))
colnames(area)

colnames(j2016_area) <- c("Block", "Plot", "Total_Shape_Area", "Year", "Burned", "Rodents")
j2016_area <- j2016_area[,c(1,2,4,3,5,6)]

j2016_area <- j2016_area |> mutate(Block = substr(Block,2,2))

typeof(area$Year)
area <- area[area$Year != 2016,]

area <- rbind(area, j2016_area)
area$Total_Shape_Area <- as.numeric(area$Total_Shape_Area)


```





Compare total area of ant mounds and disks combined between treatments and years

```{r, warning=FALSE}

hist(area$Total_Shape_Area)

area %>% group_by(Year, Plot) %>%
  summarise(ave = mean(Total_Shape_Area),
            se = sd(Total_Shape_Area)/ sqrt(n()))  |>
  ggplot(aes(Year, ave, color = Plot, fill = Plot))+
   geom_point()+
    geom_ribbon(aes(ymin = ave - se, ymax = ave + se), alpha = 0.1, color = NA)+
    geom_smooth(aes(group = Plot), alpha = 0.1) +
  theme_classic() +
  labs(x = "Year",
       y = expression(paste("Mean Disk Area per Plot  ", (m^2))))+
  theme(text = element_text(size=12, family = "serif"))
    
area$Year <- as.factor(area$Year)
                    
ggplot(data =  area, aes(Year, Total_Shape_Area, fill = Plot))+
  geom_boxplot()+
  theme_classic()

areadiff <- area |> pivot_wider(names_from = Year, values_from = Total_Shape_Area)
areadiff$tot.change <- areadiff$'2023' - areadiff$'2016'

areaaov <- aov(data = areadiff, tot.change ~ Burned + Rodents + Burned * Rodents)
summary(areaaov)

```

Create density per treatment block

```{r}

density <- disks[disks$Class_name=="disk",]

density <- density %>% group_by(Block, Plot, Year) %>%
  summarise(mean_count = mean(n()))

density <- complete_combinations %>% left_join(density, by = c("Block", "Plot", "Year")) %>%
  mutate(mean_count = ifelse(is.na(mean_count), 0, mean_count))

```


replace my 2016 density with Tara's

```{r}

jd_2016 <- read.csv("C:/Users/ryanp/Documents/Dissertation/Chapter1_Ants/Josh data/Ant mound density.csv")
jd_2016$Year <- 2016
jd_2016 <- jd_2016[,c(1,2,9,5)]
colnames(jd_2016) <- c("Block", "Plot", "Year", "mean_count")

density <- density[density$Year != 2016,]

density <- rbind(density, jd_2016)


```



```{r}
density[c("Burned", "Rodents")] <- str_split_fixed(density$Plot, "", 2)

densityaov <- aov(data = density, mean_count ~ Burned + Rodents)
summary(densityaov)

density[density$Year==2021,]|>
  ggplot(aes(Burned, mean_count, fill = Rodents)) + 
  stat_summary(geom = "bar", fun = mean, position = "dodge", color = "black", width = 0.5, show.legend = TRUE) +
  stat_summary(geom = "errorbar", fun.data = mean_se, width = 0.2, position = position_dodge(0.5))+
   theme_classic()

diffdens <- density |> pivot_wider(names_from = Year, values_from = mean_count)
diffdens$tot.change <- diffdens$'2023' - diffdens$'2016'


diffdens |> ggplot(aes(Rodents, tot.change, fill = Burned))+
  geom_boxplot() +
  theme_classic()+
  ylab("Change in mean density from 2016 to 2023")+
  scale_x_discrete(labels = c("Rodent Exclusion", "Rodent Access"))+
  scale_fill_manual(values= c("#1a80bb","#a00000"),labels = c("Burned", "Unburned"))+
  theme(text = element_text(size=12, family = 'serif'),
            legend.position = c(0.2 ,0.85), legend.title = element_blank())

aovdiffdens <- aov(data = diffdens, tot.change ~ Burned + Rodents + Burned * Rodents)
summary(aovdiffdens)

density <- density %>% group_by(Plot, Year) %>%
  summarise(count = mean(mean_count),
            se = sd(mean_count) / sqrt(n()))


density <- density %>% mutate(Burned = substr(Plot, 1, 1),
         Rodents = substr(Plot, 2, 2))



```


Plot density

```{r, warning = FALSE}

density %>% 
  ggplot(aes(Year, count, color = Plot))+
   geom_point()+
    geom_smooth(aes(group = Plot), alpha = 0.1) +
  geom_ribbon(aes(ymin = count - se, ymax = count + se, fill = Plot), alpha = 0.1, color = NA) + 
  theme_classic()+ 
  labs(x = "Year",
       y = "Mean Number of Disks per Plot")+
  theme(text = element_text(size=12, family = "serif"))
  

density$Year <- as.factor(density$Year)

ggplot(data = density, aes(Year, count, fill = Plot)) +
  geom_boxplot()


                 

```

Load manual counts for 2016 and 2021

```{r}

manual_dens_2016 <- read.csv("C:/Users/ryanp/Documents/Dissertation/Chapter1_Ants/Josh data/Ant mound density.csv")
manual_dens_2021 <- read.csv("Density_manual_2021.csv")
raw <- read.csv("C:/Users/ryanp/Documents/Dissertation/Chapter1_Ants/Ant_analysis_manua;/Ant Manuals.csv")
hist(raw$Disk.Diameter..cm.)

manual_large <- raw[raw$Disk.Diameter..cm.>= 250,] ### I think there might be a size threshold for detecting mounds

manual_large <- manual_large |> group_by(Block, Plot) %>%
  summarise(mean_count = mean(n()))

manual_large <- manual_large[-1,] # remove controls


manual_large <- manual_large %>% mutate(Burned = substr(Plot, 1, 1),
         Rodents = substr(Plot, 2, 2))



manual_dens_2021 <- manual_dens_2021 %>%
  mutate_all(~replace(., . == "BS","BR"))

manual_dens_2021 <- manual_dens_2021 %>%
  mutate_all(~replace(., . == "US","UR"))

head(manual_dens_2021)

```

Compare manual 2021 to drone 2021

```{r}

drone_2021 <- disks[disks$Class_name=="disk",]
drone_2021 <- drone_2021[drone_2021$Year== 2021,]
drone_2021 <- drone_2021 %>% group_by(Block, Plot) %>%
  summarise(mean_count = mean(n()),
            Total_Shape_Area = sum(Shape_Area))
drone_2021 <- complete_combinations[complete_combinations$Year==2021,] %>% 
  left_join(drone_2021, by = c("Block", "Plot")) %>%
  mutate(mean_count = ifelse(is.na(mean_count), 0, mean_count))

drone_2021 <- drone_2021 %>% replace(is.na(.), 0)

comp_21 <- merge(drone_2021,manual_dens_2021, by = c("Plot", "Block"), all.x = TRUE)
colnames(comp_21)

comp_21 <- comp_21 %>% select(Plot, Block, Year, mean_count, Burned, Rodents, Count)

colnames(comp_21) <- c("Plot", "Block", "Year", "Drone", "Burned", "Rodents", "Manual") 

comp_21$Manual<- as.numeric(comp_21$Manual)

t.test(comp_21$Drone, comp_21$Manual, paired = TRUE)


comp_21[comp_21$Plot=="BN"& comp_21$Method=="Drone",]


comp_21 <- comp_21 |> pivot_longer(cols = c("Drone", "Manual"), names_to = "Method", values_to = "Count")

BN21 <- rbind(comp_21[comp_21$Plot=="BN"& comp_21$Method=="Drone",],comp_21[comp_21$Plot=="BN"& comp_21$Method=="Manual",])
BN21 <- BN21 |> pivot_wider(names_from = "Method", values_from = "Count")
t.test(BN21$Drone, BN21$Manual, paired = TRUE)

ggplot(data = comp_21, aes(Plot, Count, fill = Method))+
   stat_summary(geom = "bar", fun = mean, position = "dodge", color = "black", width = 0.5) +
  stat_summary(geom = "errorbar", fun.data = mean_se, width = 0.2, position = position_dodge(0.5))+
  theme_classic() + 
    scale_y_continuous(expand = c(0, 0), limits = c(0, 11)) +
  theme(legend.position = c(0.8,0.75), text = element_text(size=12, family = "serif"))

aov21 <- aov(comp_21$Count~ comp_21$Method+ comp_21$Plot + comp_21$Method*comp_21$Plot)
summary(aov21)



```
Do the same as above but only for mounds measuring greater than 2m in diameter

```{r}

manual_large[manual_large=="BS"] <- "BR"
manual_large[manual_large=="US"] <- "UR"
comp_21_large <- merge(drone_2021, manual_large, by = c("Plot", "Block"), all.x = TRUE)
colnames(comp_21_large)


colnames(comp_21_large) <- c("Plot", "Block", "Year", "Drone","Area", "Manual", "Burned", "Rodents") 

BN21.f <- comp_21_large[comp_21_large$Plot=="BN",]
t.test(BN21.f$Drone, BN21.f$Manual, paired = TRUE)

comp_21_large <- comp_21_large |> pivot_longer(cols = c("Drone", "Manual"), names_to = "Method", values_to = "Count")

ggplot(data = comp_21_large, aes(Plot, Count, fill = Method))+
   stat_summary(geom = "bar", fun = mean, position = "dodge", color = "black", width = 0.5) +
  stat_summary(geom = "errorbar", fun.data = mean_se, width = 0.2, position = position_dodge(0.5))+
  theme_classic() + 
    scale_y_continuous(expand = c(0, 0), limits = c(0, 11)) +
    theme(title = element_text("serif"))+
  xlab( "Treatment") +
  ylab("Number of mounds detected")

aov21_large <-aov(comp_21_large$Count~ comp_21_large$Method+ comp_21_large$Plot + 
                    comp_21_large$Method*comp_21_large$Plot)
summary(aov21_large)

```


Compare my manual area to my drone area with all disks

```{r}


#### Organize manual areas #####
man_area_21 <- read.csv("Manual_area_2021.csv")
man_area_21 <- man_area_21[man_area_21$Plot != "C",] # Remove controls
man_area_21 <- man_area_21  %>% group_by(Block, Plot) %>%
  summarise(total.area = sum(Disk.Area),
            se = sd(Disk.Area)/ sqrt(n())) # Summarize to create total disk area per plot

man_area_21 <- man_area_21  %>% replace(is.na(.), 0) #remove NAs
man_area_21 <- man_area_21 %>%
  mutate_all(~replace(., . == "BS","BR")) # I used different naming conventions so I'm switching S to R
man_area_21 <- man_area_21 %>%
  mutate_all(~replace(., . == "US","UR"))
man_area_21

#### Organize 2021 drone areas ####
drone_2021

#### Merge together #####

drone_man21_comp <- merge(man_area_21, drone_2021, by = c("Block", "Plot"), all.x = TRUE)
drone_man21_comp <- drone_man21_comp |> select(Block, Plot, total.area, Total_Shape_Area)
colnames(drone_man21_comp) <- c("Block", "Plot", "Manual_area", "Drone_area")
drone_man21_comp$Manual_area <- as.numeric(drone_man21_comp$Manual_area)
drone_man21_comp

#### Plot comparison between manual and drone ####
drone_man21_comp |> 
  pivot_longer(cols = c("Drone_area", "Manual_area"), names_to = "Method", values_to = "Area") |> 
  ggplot(aes(Plot, Area, fill = Method))+
   stat_summary(geom = "bar", fun = mean, position = "dodge", color = "black", width = 0.5) +
  stat_summary(geom = "errorbar", fun.data = mean_se, width = 0.2, position = position_dodge(0.5))+
  theme_classic()



```

Compare my manual area to my drone area with the 250cm diamter cutoff


```{r}


#### Organize manual areas #####
man_area_21 <- read.csv("Manual_area_2021.csv")
man_area_21 <- man_area_21[man_area_21$Plot != "C",] # Remove controls
man_area_21 <- man_area_21[man_area_21$Disk.Diameter..cm.>=250,]
man_area_21 <- man_area_21  %>% group_by(Block, Plot) %>%
  summarise(total.area = sum(Disk.Area),
            se = sd(Disk.Area)/ sqrt(n())) # Summarize to create total disk area per plot

man_area_21 <- man_area_21  %>% replace(is.na(.), 0) #remove NAs
man_area_21 <- man_area_21 %>%
  mutate_all(~replace(., . == "BS","BR")) # I used different naming conventions so I'm switching S to R
man_area_21 <- man_area_21 %>%
  mutate_all(~replace(., . == "US","UR"))
man_area_21

#### Organize 2021 drone areas ####
drone_2021

#### Merge together #####

drone_man21_comp <- merge(man_area_21, drone_2021, by = c("Block", "Plot"), all.x = TRUE)
drone_man21_comp <- drone_man21_comp |> select(Block, Plot, total.area, Total_Shape_Area)
colnames(drone_man21_comp) <- c("Block", "Plot", "Manual_area", "Drone_area")
drone_man21_comp$Manual_area <- as.numeric(drone_man21_comp$Manual_area)
drone_man21_comp

#### Plot comparison between manual and drone ####
drone_man21_comp |> 
  pivot_longer(cols = c("Drone_area", "Manual_area"), names_to = "Method", values_to = "Area") |> 
  ggplot(aes(Plot, Area, fill = Method))+
   stat_summary(geom = "bar", fun = mean, position = "dodge", color = "black", width = 0.5) +
  stat_summary(geom = "errorbar", fun.data = mean_se, width = 0.2, position = position_dodge(0.5))+
  theme_classic()

```

